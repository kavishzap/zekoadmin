import { useEffect, useState } from 'react';
import { createClient } from '@supabase/supabase-js';
import Swal from 'sweetalert2';
import jsPDF from 'jspdf';
import QRCode from 'qrcode';
import emailjs from 'emailjs-com';

const supabase = createClient(
    import.meta.env.VITE_REACT_APP_SUPABASE_URL!,
    import.meta.env.VITE_REACT_APP_SUPABASE_ANON_KEY!
);

type Booking = {
    concertImage: any;
    created_at: string | number | Date;
    id: string;
    userid: string;
    concertid: string;
    tickets: any[];
    total: number;
    status: boolean;
    userName?: string;
    concertName?: string;
};

const PER_PAGE = 10;

const BookingTable = () => {
    const [bookings, setBookings] = useState<Booking[]>([]);
    const [loading, setLoading] = useState(true);
    const [currentPage, setCurrentPage] = useState(1);
    const [totalBookings, setTotalBookings] = useState(0);
    const [search, setSearch] = useState('');
    const [downloadingId, setDownloadingId] = useState<string | null>(null);

    useEffect(() => {
        fetchBookings();
        fetchTotalCount();
    }, [currentPage]);

    const hashString = async (input: string): Promise<string> => {
        const encoder = new TextEncoder();
        const data = encoder.encode(input);
        const hashBuffer = await crypto.subtle.digest("SHA-256", data);
        return Array.from(new Uint8Array(hashBuffer))
            .map((b) => b.toString(16).padStart(2, "0"))
            .join("");
    };

    const compressImage = (base64Str: string, maxWidth = 600, maxHeight = 800): Promise<string> => {
        return new Promise((resolve) => {
            const img = new Image();
            img.src = base64Str;

            img.onload = () => {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;

                if (width > height) {
                    if (width > maxWidth) {
                        height *= maxWidth / width;
                        width = maxWidth;
                    }
                } else {
                    if (height > maxHeight) {
                        width *= maxHeight / height;
                        height = maxHeight;
                    }
                }

                canvas.width = width;
                canvas.height = height;

                const ctx = canvas.getContext('2d');
                ctx?.drawImage(img, 0, 0, width, height);
                const compressedDataUrl = canvas.toDataURL('image/jpeg', 0.7); // Adjust quality
                resolve(compressedDataUrl);
            };
        });
    };


    const downloadTicket = async (booking: Booking, shouldDownload = true) => {

        setDownloadingId(booking.id);
        try {
            const { data: userProfile, error: userError } = await supabase
                .from('user_profiles')
                .select('first_name, last_name, email')
                .eq('id', booking.userid)
                .single();

            if (userError || !userProfile) {
                console.error('Failed to fetch user profile for booking:', userError);
                Swal.fire('Error', 'Unable to load user profile.', 'error');
                return;
            }

            const { data: concert } = await supabase
                .from('concerts')
                .select('concert_name, concert_location_name, concert_date, concert_start_time, concert_end_time, logo, terms')
                .eq('concert_name', booking.concertName)
                .single()

            const doc = new jsPDF()
            let y = 20
            const pageWidth = doc.internal.pageSize.getWidth()
            const margin = 15

            // Header Text
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text('BOOKING VOUCHER', margin, y);

            // Logo on right
            const logoImg = 'data:image/png;base64,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'; // replace with your logo base64 string
            const logoWidth = 30;
            const logoHeight = 8;
            const logoX = pageWidth - margin - logoWidth;
            const logoY = y - 6; // align vertically with text

            try {
                doc.addImage(logoImg, 'PNG', logoX, logoY, logoWidth, logoHeight);
            } catch (err) {
                console.warn('Error loading logo:', err);
            }

            try {
                // FIRST IMAGE (e.g. your asset image)
                let assetImg = '';
                let compressedConcertImage1 = '';
                try {
                    if (concert?.logo) {
                        assetImg = concert.logo.startsWith('data:')
                            ? concert.logo
                            : `data:image/png;base64,${concert.logo}`;
                    }
                    compressedConcertImage1 = await compressImage(assetImg);
                } catch (e) {
                    console.warn('Logo image fallback failed:', e);
                }
                const assetWidth = 30;
                const assetHeight = 6;
                const spacing = 5; // space between images
                const assetX = logoX - spacing - assetWidth;
                const assetY = logoY;
                doc.addImage(compressedConcertImage1, 'PNG', assetX, assetY, assetWidth, assetHeight);

                // THEN YOUR ORIGINAL LOGO
                doc.addImage(logoImg, 'PNG', logoX, logoY, logoWidth, logoHeight);
            } catch (err) {
                console.warn('Error loading images:', err);
            }

            y += 10;

            // Add concert image
            // Add concert image on the left, QR on the right (side by side)
            if (booking.concertImage) {
                const concertImageBase64 = booking.concertImage.startsWith('data:')
                    ? booking.concertImage
                    : `data:image/jpeg;base64,${booking.concertImage}`;
                const compressedConcertImage = await compressImage(concertImageBase64);
                try {
                    const imgWidth = 40;
                    const imgHeight = 50;
                    const imgX = margin; // Left margin
                    const imgY = y;

                    const qrSize = 48;
                    const qrX = pageWidth - margin - qrSize; // Right aligned
                    const qrY = y; // Same Y as image

                    // Add concert image
                    doc.addImage(compressedConcertImage, 'JPEG', imgX, imgY, imgWidth, imgHeight);

                    // Add QR code
                    const rawQrValue = `TICKET-${booking.id}`;
                    const hashedQrValue = await hashString(rawQrValue);
                    const qrDataUrl = await QRCode.toDataURL(hashedQrValue);
                    doc.addImage(qrDataUrl, 'PNG', qrX, qrY, qrSize, qrSize);

                    y += imgHeight + 8; // Move down after both
                } catch (imgErr) {
                    console.warn('Could not load concert image into PDF:', imgErr);
                }
            }


            y += 6;

            doc.setFont('helvetica', 'normal')
            doc.setFontSize(12)
            doc.text(`ORDER REFERENCE NO:  TICKET-${booking.id}`, margin, y)

            y += 6

            console.log('Booking created at:', booking.created_at)
            const orderDate = booking.created_at
                ? new Date(booking.created_at).toLocaleString('en-MU', {
                    year: 'numeric',
                    month: 'short',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                })
                : 'N/A'

            doc.setFontSize(10)
            doc.text(`Order Date: ${orderDate}`, margin, y)

            y += 10
            doc.setDrawColor(200)
            doc.setLineWidth(0.5)
            doc.line(margin, y, pageWidth - margin, y)

            // Event title
            y += 10
            doc.setFontSize(14)
            doc.setFont('helvetica', 'bold')
            doc.setTextColor(0, 102, 204)
            doc.text(concert?.concert_name?.toUpperCase() || 'EVENT NAME', pageWidth / 2, y, { align: 'center' })

            // Customer Info
            y += 10
            doc.setTextColor(0)
            doc.setFontSize(12)
            doc.setFont('helvetica', 'bold')
            doc.text('Customer Details', margin, y)

            y += 8
            doc.setFont('helvetica', 'normal')
            doc.text(`Full Name: ${userProfile?.first_name || ''} ${userProfile?.last_name || ''}`, margin, y)

            y += 6
            doc.text(`Email: ${userProfile.email}`, margin, y)

            y += 8
            doc.setFontSize(11)
            doc.setFont('helvetica', 'bold')
            if (booking.status) {
                doc.setTextColor(0, 150, 0) // green
                doc.text('STATUS OF INVOICE: PAID', margin, y)
            } else {
                doc.setTextColor(200, 0, 0) // red
                doc.text('STATUS OF INVOICE: UNPAID', margin, y)
            }
            doc.setTextColor(0) // reset text color


            // Booking Details
            y += 12
            doc.setFont('helvetica', 'bold')
            doc.setFontSize(12)
            doc.text('Booking Details', margin, y)

            y += 8
            doc.setFont('helvetica', 'normal')
            doc.text(`Date: ${concert?.concert_date || '-'}`, margin, y)
            y += 6
            doc.text(`Start Time: ${concert?.concert_start_time || '-'}`, margin, y)
            doc.text(`End Time: ${concert?.concert_end_time || '-'}`, margin + 60, y)

            y += 6
            doc.text(`Location: ${concert?.concert_location_name || '-'}, Mauritius`, margin, y)

            // Tickets
            y += 10
            const { data: ticketData } = await supabase
                .from('tickets')
                .select('id, ticket_name')

            if (Array.isArray(booking.tickets)) {
                doc.setFont('helvetica', 'bold')
                doc.text('Tickets:', margin, y)
                y += 6

                // Table header
                doc.setFontSize(10)
                doc.setFont('helvetica', 'bold')
                doc.text('#', margin + 2, y)
                doc.text('Ticket Name', margin + 15, y)
                doc.text('Qty', margin + 120, y)
                y += 5
                doc.setDrawColor(180)
                doc.line(margin, y, pageWidth - margin, y)
                y += 4

                doc.setFont('helvetica', 'normal')
                booking.tickets.forEach((ticket, index) => {
                    const ticketName = ticketData?.find(t => t.id === ticket.ticket_id)?.ticket_name || `ID ${ticket.ticket_id}`
                    doc.text(String(index + 1), margin + 2, y)
                    doc.text(ticketName, margin + 15, y)
                    doc.text(String(ticket.quantity), margin + 120, y)


                    y += 6
                })
            }

            // Notes
            y += 10;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.text(`Terms and Conditions â€“ ${concert?.concert_name || 'Concert'}`, margin, y);
            y += 8;

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            const terms = concert?.terms
                ? concert.terms.split('\n').map((line: string) => line.trim()).filter(Boolean)
                : [];

            terms.forEach((line: string) => {
                const safeBottom = 270;
                const lineHeight = 5;
                const wrapped = doc.splitTextToSize(line, pageWidth - margin * 2);

                wrapped.forEach((wrappedLine: string | string[]) => {
                    if (y + lineHeight > safeBottom) {
                        doc.addPage();
                        y = 20;
                    }
                    doc.text(wrappedLine, margin, y);
                    y += lineHeight;
                });
            });


            // Footer
            y += 5
            doc.setFontSize(10)
            doc.setTextColor(80)
            doc.text('Need Help? Call us at +230 5918 2520 or visit www.zekomru.com', margin, y)

            // Save PDF
            if (shouldDownload) {
                doc.save(`Ticket-${booking.id}.pdf`)
            }
            return doc;
        } finally {
            setDownloadingId(null)
        }
    }



    const fetchBookings = async () => {
        setLoading(true);
        const from = (currentPage - 1) * PER_PAGE;
        const to = from + PER_PAGE - 1;

        const { data: bookingsData, error: bookingsError } = await supabase
            .from('bookings')
            .select('*')
            .order('created_at', { ascending: false }) // <-- sort by latest
            .range(from, to);


        if (bookingsError || !bookingsData) {
            console.error(bookingsError);
            setLoading(false);
            return;
        }

        // Unique user and concert IDs
        const userIds = [...new Set(bookingsData.map(b => b.userid))];
        const concertIds = [...new Set(bookingsData.map(b => b.concertid))];

        // Extract all ticket_ids from all bookings
        const ticketIds = Array.from(
            new Set(
                bookingsData
                    .flatMap(b => (Array.isArray(b.tickets) ? b.tickets.map((t: { ticket_id: any; }) => t.ticket_id) : []))
                    .filter(Boolean)
            )
        );

        // Fetch users
        const { data: usersData } = await supabase
            .from('user_profiles')
            .select('id, first_name, last_name')
            .in('id', userIds);

        // Fetch concerts
        const { data: concertsData } = await supabase
            .from('concerts')
            .select('id, concert_name ,concert_image, front_image')
            .in('id', concertIds);

        // Fetch ticket names
        const { data: ticketData } = await supabase
            .from('tickets')
            .select('id, ticket_name')
            .in('id', ticketIds);

        const userMap = new Map(usersData?.map(u => [u.id, `${u.first_name} ${u.last_name}`]));
        const concertMap = new Map(concertsData?.map(c => [c.id.toString(), c.concert_name]));
        const ticketMap = new Map(ticketData?.map(t => [t.id, t.ticket_name]));

        // Merge enriched booking
        const merged = bookingsData.map(b => ({
            ...b,
            userName: userMap.get(b.userid) || b.userid,
            concertName: concertMap.get(b.concertid.toString()) || b.concertid,
            concertImage: concertsData?.find(c => c.id.toString() === b.concertid.toString())?.front_image || null,
            tickets: Array.isArray(b.tickets)
                ? b.tickets.map((t: { ticket_id: any; }) => ({
                    ...t,
                    ticket_name: ticketMap.get(t.ticket_id) || t.ticket_id
                }))
                : []
        }));

        setBookings(merged);
        setLoading(false);
    };

    const fetchTotalCount = async () => {
        const { count } = await supabase
            .from('bookings')
            .select('*', { count: 'exact', head: true });

        if (count !== null) setTotalBookings(count);
    };

    const handleToggleStatus = async (booking: Booking) => {
        const confirm = await Swal.fire({
            title: 'Change Status?',
            text: `This will mark the booking as ${!booking.status ? 'confirmed' : 'pending'}.`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, change it',
            cancelButtonText: 'Cancel',
        });

        if (!confirm.isConfirmed) return;

        // If confirming the booking (false -> true)
        if (!booking.status) {
            // Fetch latest ticket quantities from DB
            const ticketIds = booking.tickets.map(t => t.ticket_id);
            const { data: currentTickets, error } = await supabase
                .from('tickets')
                .select('id, quantity')
                .in('id', ticketIds);

            if (error) {
                console.error(error);
                Swal.fire('Error', 'Failed to fetch ticket stock.', 'error');
                return;
            }

            const updates = booking.tickets.map((t) => {
                const current = currentTickets?.find(ct => ct.id === t.ticket_id);
                const remainingQty = current ? current.quantity - t.quantity : 0;
                return {
                    id: t.ticket_id,
                    quantity: remainingQty < 0 ? 0 : remainingQty,
                };
            });

            // Batch update tickets
            for (const update of updates) {
                const { error: updateError } = await supabase
                    .from('tickets')
                    .update({ quantity: update.quantity })
                    .eq('id', update.id);

                if (updateError) {
                    console.error(updateError);
                    Swal.fire('Error', `Failed to update ticket ID ${update.id}.`, 'error');
                    return;
                }
            }
        }

        // Update booking status
        const { error: bookingError } = await supabase
            .from('bookings')
            .update({ status: !booking.status })
            .eq('id', booking.id);

        if (!bookingError) {
            fetchBookings();
            Swal.fire('Updated!', 'Booking status updated.', 'success');
        } else {
            Swal.fire('Error', 'Failed to update booking status.', 'error');
        }
    };


    const totalPages = Math.ceil(totalBookings / PER_PAGE);

    const filteredBookings = bookings.filter((b) =>
        b.userName?.toLowerCase().includes(search.toLowerCase())
    );




    const uploadPdfAndSendEmail = async (booking: Booking, doc: jsPDF, userProfile: any) => {
        const pdfBlob = doc.output('blob');
        const fileName = `ticket-${booking.id}.pdf`;

        // âœ… Upload PDF to Supabase Storage bucket "ticket_pdfs"
        const { error: uploadError } = await supabase.storage
            .from('ticket-pdfs') // â¬…ï¸ bucket name updated
            .upload(fileName, pdfBlob, {
                cacheControl: '3600',
                upsert: true,
                contentType: 'application/pdf',
            });

        if (uploadError) throw new Error('Failed to upload PDF');

        // âœ… Get Public URL
        const { data: urlData } = supabase
            .storage
            .from('ticket-pdfs') // â¬…ï¸ bucket name updated
            .getPublicUrl(fileName);

        const publicUrl = urlData?.publicUrl;
        if (!publicUrl) throw new Error('Failed to get public URL');

        // âœ… Save to bookings table
        await supabase
            .from('bookings')
            .update({ ticket_pdf_url: publicUrl })
            .eq('id', booking.id);


        await emailjs.send(
            "service_6b51l4k",
            "template_9qnu5wg",
            {
                email: userProfile.email,
                to_name: `${userProfile.first_name} ${userProfile.last_name}`,
                ticket_url: publicUrl // âœ… matches {{ticket_url}} in your template
            },
            "PoTflV-_4nllw5cKF"
        );

    };


    const handleSendEmail = async (booking: Booking) => {
        setDownloadingId(booking.id);
        try {
            const doc = await downloadTicket(booking, false);  // generates jsPDF

            if (!doc) {
                Swal.fire('Error', 'Failed to generate PDF document', 'error');
                return;
            }

            const { data: userProfile } = await supabase
                .from('user_profiles')
                .select('first_name, last_name, email')
                .eq('id', booking.userid)
                .single();

            if (!userProfile || !userProfile.email) {
                Swal.fire('Error', 'User email is missing', 'error');
                return;
            }

            await uploadPdfAndSendEmail(booking, doc, userProfile);
            Swal.fire('Success', 'Ticket email sent successfully!', 'success');
        } catch (err) {
            console.error(err);
            Swal.fire('Error', 'Failed to send email', 'error');
        } finally {
            setDownloadingId(null);
        }
    };



    return (
        <div>
            <h2 className="text-xl font-bold mb-4">Bookings</h2>

            <input
                type="text"
                className="form-input mb-4 w-full"
                placeholder="Filter by user name..."
                value={search}
                onChange={(e) => setSearch(e.target.value)}
            />

            {loading ? (
                <p>Loading bookings...</p>
            ) : (
                <>
                    <table className="table table-striped w-full">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Concert</th>
                                <th>Tickets</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Ticket</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredBookings.map((b) => (
                                <tr key={b.id}>
                                    <td>{b.id}</td>
                                    <td>{b.userName}</td>
                                    <td>{b.concertName}</td>
                                    <td>
                                        {Array.isArray(b.tickets) && b.tickets.length > 0 ? (
                                            b.tickets.map((t, i) => (
                                                <div key={i}>
                                                    Ticket: {t.ticket_name} , Qty: {t.quantity}
                                                </div>
                                            ))
                                        ) : (
                                            'No tickets'
                                        )}
                                    </td>
                                    <td>MUR {b.total}</td>
                                    <td>
                                        {b.status ? (
                                            <span className="px-2 py-1 text-sm font-semibold text-green-700 bg-green-100 rounded">
                                                Dispatched
                                            </span>
                                        ) : (
                                            <label className="inline-flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    className="sr-only"
                                                    checked={b.status}
                                                    onChange={() => handleToggleStatus(b)}
                                                />
                                                <div className="w-10 h-5 bg-gray-300 rounded-full relative">
                                                    <div className="w-5 h-5 bg-white rounded-full shadow transform transition-transform translate-x-0" />
                                                </div>
                                            </label>
                                        )}
                                    </td>
                                    <td>
                                        <button
                                            className="btn btn-sm btn-outline-success"
                                            onClick={() => downloadTicket(b, true)}
                                            disabled={downloadingId === b.id}
                                        >
                                            {downloadingId === b.id ? 'Downloading...' : 'Download'}
                                        </button>

                                    </td>
                                    <td>
                                        <button
                                            className="btn btn-sm btn-outline-primary"
                                            onClick={() => handleSendEmail(b)}
                                            disabled={downloadingId === b.id}
                                        >
                                            {downloadingId === b.id ? 'Sending...' : 'Send Email'}
                                        </button>

                                    </td>

                                </tr>
                            ))}
                        </tbody>
                    </table>

                    <div className="flex justify-between mt-4">
                        <button
                            className="btn btn-primary"
                            disabled={currentPage === 1}
                            onClick={() => setCurrentPage(prev => prev - 1)}
                        >
                            Previous
                        </button>
                        <span className="self-center">Page {currentPage} of {totalPages}</span>
                        <button
                            className="btn btn-primary"
                            disabled={currentPage === totalPages}
                            onClick={() => setCurrentPage(prev => prev + 1)}
                        >
                            Next
                        </button>
                    </div>
                </>
            )}
        </div>
    );
};

export default BookingTable;